LINK: https://github.com/alexisvarjo/cybsec-project
I recommend creating your own virtual environment when initializing the project.
The OWASP list I’m using is the 2017 top 10 web application security risks list.
You can seed the application by running python manage.py seed_users

FLAW 1:
The first flaw is an SQL injection (OWASP #1). The flaw occurs here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/views.py#L15.

The root cause of the flaw is that the app constructs an SQL query trusting the user too much, by just gathering the username and password, and constructing the final query as a string based on this. The problem is, that a user with malicious intentions can guess what the query looks like, and come up with a response to the question of “username” and “password” with such values that they can query sensitive data. This can often be done with “--” syntax in SQL starting a comment, but also join and intersection statements can be injected.

Historically SQL injections have been one of the most exploited vulnerabilities. There also exists tools to automate the exploitation of the vulnerability. Another way to fix instead of using parameters would be to use ORMs, like ones offered by Django.

The best way to fix this flaw would be to use parametric queries. In many frameworks and libraries there are ready made solutions where the code only takes a parameter to the queries, nothing else. These parameters ensure that something like “--” will not alter the query by starting a comment, but will just be interpreted as those characters in the query.

I have included the fix in commented code, which starts here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/views.py#L37 and https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/models.py#L7

The input used for demoing this vulnerability is the following:”admin’ -- “ and no password.

FLAW 2:
The second flaw is broken authentication (OWASP #2). The flaw occurs here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/views.py#L24 

The problem with flaw 2 is that the authentication is broken. There should be a session expiry timer, so that a session does not persist. If somebody can steal the session cookie, they can use the hijacked session without any time limitation, leading to persistent unauthorized access. In addition the flaw is made worse by a lack of secure flags in settings.py file of django, located here: https://github.com/alexisvarjo/cybsec-project/blob/master/project/project/settings.py. Best practices could be multi-factor authentication instead of only fixing sessions.

The way to fix it is to use django’s own login logic instead of writing own logic. Many frameworks have their ready-made way to implement login which should be used. Additionally the most crucial fixes are to use a couple request.session attributes and methods and to alter settings.py. The (manual) fixes are located here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/views.py#L25 and here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/project/settings.py#L125 

FLAW 3:
The third flaw is sensitive data exposure (OWASP #3). The flaw occurs here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/models.py#L3

The problem with this flaw is that passwords are stored in plaintext. This means that if and when there ever is a data breach, all passwords will be exposed. It is quite a serious flaw as people use the same credentials for multiple services, even though that’s not recommended. The issue arises mostly because of trying to define own logic for storing passwords, even though the framework once again has a ready-made solution for this.

The way to fix this is to use django’s own solution, or with another framework use that framework’s solution. The fix is located here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/models.py#L12 The abstraction django provides uses salting and hashing behind the scenes. Even if a data breach were to happen, salting prevents rainbow table attacks, and the hashing algorithm used is deliberately slow to run, to slow down brute-force attempts. The idea with salting is to add a unique, random string of characters to all passwords. This is to slow down the use of precomputed password-to-hash tables. It also has the benefit of giving two users with the same password different hashes.

The flaw isn’t shown in the screenshots as it is not really visible to the user in any way in the browser.

FLAW 4:
The fourth flaw is that there’s no access control for the admin panel. If anybody tries to access it, they can. This is OWASP #5 and referred to as broken access control. The flaw is located here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/views.py#L50

The problem with this flaw is obvious. No web service wants a malicous user access to any kind of admin panel, as that place often contains functions that can be used against the service and other users, and can also expose the data of other users. The flaw stems from not checking whether an user is admin or not, instead just replying straight with the admin panel site regardless of who is requesting it.

The way to fix this would be to check firstly if the user is logged in, and then secondly checking whether the user role is actually set to admin before granting access. The fix is contained here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/views.py#L52

The demo is done with test user that has user name “test” and password “1234”

FLAW 5:
The fifth flaw is a XSS vulnerability (OWASP #7). The flaw is located here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/views.py#L37 

The flaw arises when the code requests a user session variable, where a user with malicious intent could include a script. The risks of this kind of vulnerability include account hijacking via stealing cookies or session tokens, injecting malicious html / js to the web page, privilege escalation and sensitive data exposure. Thus this issue is very serious. There are there different types of XSS: stored XSS that persists in a DB; reflected XSS via URL parameters; and DOM-based XSS inside JS code.

The way to fix this flaw is located here: https://github.com/alexisvarjo/cybsec-project/blob/bccc25bf042f74a06c2a4895af4f1a53fcfa3bbc/project/app/views.py#L44. In the fixed version django handles escaping any javascript or html that could be injected via the vulnerability.

This flaw is demoed with a demo user that has the username of “<img src=x onerror=alert(1)>” and password “pw”.
